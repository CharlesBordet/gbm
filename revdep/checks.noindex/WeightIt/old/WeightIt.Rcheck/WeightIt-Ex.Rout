
R version 4.0.0 (2020-04-24) -- "Arbor Day"
Copyright (C) 2020 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin17.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> pkgname <- "WeightIt"
> source(file.path(R.home("share"), "R", "examples-header.R"))
> options(warn = 1)
> library('WeightIt')
> 
> base::assign(".oldSearch", base::search(), pos = 'CheckExEnv')
> base::assign(".old_wd", base::getwd(), pos = 'CheckExEnv')
> cleanEx()
> nameEx("ESS")
> ### * ESS
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: ESS
> ### Title: Compute effective sample size of weighted sample
> ### Aliases: ESS
> 
> ### ** Examples
> 
> library("cobalt")
 cobalt (Version 4.2.2, Build Date: 2020-06-26 15:50:03 UTC)
> data("lalonde", package = "cobalt")
> 
> #Balancing covariates between treatment groups (binary)
> (W1 <- weightit(treat ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "ps", estimand = "ATE"))
A [3mweightit[23m object
 - method: "ps" (propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATE
 - covariates: age, educ, married, nodegree, re74
> summary(W1)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

           Min                                   Max
treated 1.5560  |--------------------------| 73.3315
control 1.0222 ||                             3.0438

- [3mUnits with 5 greatest weights by group[23m:
                                                
             184     182     181     172     124
 treated 11.2281 11.3437 12.0848 26.1775 73.3315
             595     411     409     296     269
 control  2.3303  2.4365  2.5005  2.6369  3.0438

- [3mWeight statistics[23m:

        Coef of Var   MAD Entropy
treated       1.609 0.555 309.878
control       0.247 0.211 165.655
overall       1.595 0.458 647.264

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 429.000 185.000
Weighted   404.348  51.735
> ESS(W1$weights[W1$treat == 0])
[1] 404.3484
> ESS(W1$weights[W1$treat == 1])
[1] 51.73462
> 
> 
> 
> cleanEx()

detaching â€˜package:cobaltâ€™

> nameEx("as.weightit")
> ### * as.weightit
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: as.weightit
> ### Title: Create a 'weightit' object manually
> ### Aliases: as.weightit as.weightitMSM as.weightit.default
> ###   as.weightitMSM.default
> 
> ### ** Examples
> 
> treat <- rbinom(500, 1, .3)
> weights <- rchisq(500, df = 2)
> W <- as.weightit(weights= weights, treat = treat,
+                  estimand = "ATE")
> summary(W)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

           Min                                   Max
treated 0.0000 |------------|                 7.6018
control 0.0246 |---------------------------| 15.2679

- [3mUnits with 5 greatest weights by group[23m:
                                             
            405    308    300     139      46
 treated 6.3614 6.7201 6.8311  7.0867  7.6018
            490    221    118      32      16
 control 8.9805 9.4039 9.6949 11.8394 15.2679

- [3mWeight statistics[23m:

        Coef of Var   MAD Entropy
treated       0.995 0.746 133.993
control       1.055 0.788 432.162
overall       1.053 0.782 573.236

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 355.000 145.000
Weighted   168.315  73.125
> 
> 
> 
> cleanEx()
> nameEx("get_w_from_ps")
> ### * get_w_from_ps
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: get_w_from_ps
> ### Title: Get weights from propensity scores corresponding to different
> ###   estimands
> ### Aliases: get_w_from_ps
> 
> ### ** Examples
> 
> library("cobalt")
 cobalt (Version 4.2.2, Build Date: 2020-06-26 15:50:03 UTC)
> data("lalonde", package = "cobalt")
> 
> ps.fit <- glm(treat ~ age + educ + race + married +
+                 nodegree + re74 + re75, data = lalonde,
+               family = binomial)
> ps <- ps.fit$fitted.values
> 
> w1 <- get_w_from_ps(ps, treat = lalonde$treat,
+                     estimand = "ATT")
> 
> treatAB <- factor(ifelse(lalonde$treat == 1, "A", "B"))
> w2 <- get_w_from_ps(ps, treat = treatAB,
+                     estimand = "ATT", focal = "A")
> all.equal(w1, w2)
[1] TRUE
> w3 <- get_w_from_ps(ps, treat = treatAB,
+                     estimand = "ATT", treated = "A")
> all.equal(w1, w3)
[1] TRUE
> 
> #Using MMWS
> w4 <- get_w_from_ps(ps, treat = lalonde$treat,
+                     estimand = "ATE", subclass = 20,
+                     stabilize = TRUE)
> 
> #A multi-category example using GBM predicted probabilities
> library(gbm)
Loaded gbm 2.1.5
> T3 <- factor(sample(c("A", "B", "C"), nrow(lalonde), replace = TRUE))
> 
> gbm.fit <- gbm(T3 ~ age + educ + race + married +
+                  nodegree + re74 + re75, data = lalonde,
+                distribution = "multinomial", n.trees = 200,
+                interaction.depth = 3)
> ps.multi <- drop(predict(gbm.fit, type = "response",
+                          n.trees = 200))
> w <- get_w_from_ps(ps.multi, T3, estimand = "ATE")
> 
> 
> 
> 
> cleanEx()

detaching â€˜package:gbmâ€™, â€˜package:cobaltâ€™

> nameEx("make_full_rank")
> ### * make_full_rank
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: make_full_rank
> ### Title: Make a matrix full rank
> ### Aliases: make_full_rank
> 
> ### ** Examples
> 
> set.seed(1000)
> c1 <- rbinom(10, 1, .4)
> c2 <- 1-c1
> c3 <- rnorm(10)
> c4 <- 10*c3
> mat <- data.frame(c1, c2, c3, c4)
> 
> make_full_rank(mat) #leaves c2 and c4
   c2          c4
1   1  -3.8548930
2   0  -4.7586788
3   1   7.1975069
4   0  -0.1850562
5   1 -13.7311776
6   1  -9.8242783
7   0  -5.5448870
8   1   1.2138119
9   1  -1.2087232
10  1 -13.3604105
> 
> make_full_rank(mat, with.intercept = FALSE) #leaves c1, c2, and c4
   c1 c2          c4
1   0  1  -3.8548930
2   1  0  -4.7586788
3   0  1   7.1975069
4   1  0  -0.1850562
5   0  1 -13.7311776
6   0  1  -9.8242783
7   1  0  -5.5448870
8   0  1   1.2138119
9   0  1  -1.2087232
10  0  1 -13.3604105
> 
> 
> 
> cleanEx()
> nameEx("method-cbps")
> ### * method-cbps
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: method_cbps
> ### Title: Covariate Balancing Propensity Score Weighting
> ### Aliases: method_cbps
> 
> ### ** Examples
> 
> library("cobalt")
 cobalt (Version 4.2.2, Build Date: 2020-06-26 15:50:03 UTC)
> data("lalonde", package = "cobalt")
> 
> #Balancing covariates between treatment groups (binary)
> (W1 <- weightit(treat ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "cbps", estimand = "ATT"))
A [3mweightit[23m object
 - method: "cbps" (covariate balancing propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, re74
> summary(W1)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

          Min                                  Max
treated 1.000              ||               1.0000
control 0.017 |---------------------------| 2.2742

- [3mUnits with 5 greatest weights by group[23m:
                                           
              1      2      3      4      5
 treated      1      1      1      1      1
            595    589    409    296    269
 control 1.4755 1.4873 1.5799 1.7484 2.2742

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.000 0.000    0.000
control       0.839 0.707 -214.522
overall       0.663 0.606 -153.527

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 429.000     185
Weighted   251.985     185
> bal.tab(W1)
[4mCall[24m
 weightit(formula = treat ~ age + educ + married + nodegree + re74, data = lalonde, method = "cbps", estimand = "ATT")

[4mBalance Measures[24m
               Type Diff.Adj
prop.score Distance   0.0163
age         Contin.  -0.0032
educ        Contin.   0.0017
married      Binary  -0.0003
nodegree     Binary  -0.0003
re74        Contin.   0.0005

[4mEffective sample sizes[24m
           Control Treated
Unadjusted 429.000     185
Adjusted   251.985     185
> 
> ## Not run: 
> ##D #Balancing covariates with respect to race (multinomial)
> ##D (W2 <- weightit(race ~ age + educ + married +
> ##D                   nodegree + re74, data = lalonde,
> ##D                 method = "cbps", estimand = "ATE"))
> ##D summary(W2)
> ##D bal.tab(W2)
> ## End(Not run)
> 
> #Balancing covariates with respect to re75 (continuous)
> (W3 <- weightit(re75 ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "cbps", over = FALSE))
A [3mweightit[23m object
 - method: "cbps" (covariate balancing propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: continuous
 - covariates: age, educ, married, nodegree, re74
> summary(W3)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

       Min                                   Max
all 0.0153 |---------------------------| 13.1553

- [3mUnits with 5 greatest weights by group[23m:
                                           
        484     483     482     481     180
 all 9.2225 10.8379 11.1353 11.9904 13.1553

- [3mWeight statistics[23m:

    Coef of Var   MAD Entropy
all       1.152 0.449 178.615

- [3mEffective Sample Sizes[23m:

            Total
Unweighted 614.00
Weighted   264.09
> bal.tab(W3)
[4mCall[24m
 weightit(formula = re75 ~ age + educ + married + nodegree + re74, data = lalonde, method = "cbps", over = FALSE)

[4mBalance Measures[24m
            Type Corr.Adj
age      Contin.  -0.0002
educ     Contin.   0.0000
married   Binary  -0.0002
nodegree  Binary   0.0000
re74     Contin.  -0.0003

[4mEffective sample sizes[24m
            Total
Unadjusted 614.00
Adjusted   264.09
> 
> 
> 
> cleanEx()

detaching â€˜package:cobaltâ€™

> nameEx("method-ebal")
> ### * method-ebal
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: method_ebal
> ### Title: Entropy Balancing
> ### Aliases: method_ebal
> 
> ### ** Examples
> 
> library("cobalt")
 cobalt (Version 4.2.2, Build Date: 2020-06-26 15:50:03 UTC)
> data("lalonde", package = "cobalt")
> 
> #Balancing covariates between treatment groups (binary)
> (W1 <- weightit(treat ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "ebal", estimand = "ATT"))
A [3mweightit[23m object
 - method: "ebal" (entropy balancing)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, re74
> summary(W1)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

           Min                                  Max
treated 1.0000              ||               1.0000
control 0.0172 |---------------------------| 2.2624

- [3mUnits with 5 greatest weights by group[23m:
                                           
              1      2      3      4      5
 treated      1      1      1      1      1
            595    589    409    296    269
 control 1.4643 1.4847 1.5763 1.7433 2.2624

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.000 0.000    0.000
control       0.838 0.707 -214.703
overall       0.663 0.606 -153.653

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 429.000     185
Weighted   252.163     185
> bal.tab(W1)
[4mCall[24m
 weightit(formula = treat ~ age + educ + married + nodegree + re74, data = lalonde, method = "ebal", estimand = "ATT")

[4mBalance Measures[24m
            Type Diff.Adj
age      Contin.  -0.0001
educ     Contin.   0.0000
married   Binary   0.0000
nodegree  Binary   0.0000
re74     Contin.  -0.0002

[4mEffective sample sizes[24m
           Control Treated
Unadjusted 429.000     185
Adjusted   252.163     185
> 
> #Balancing covariates with respect to race (multinomial)
> (W2 <- weightit(race ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "ebal", estimand = "ATE",
+                 standardize = TRUE))
A [3mweightit[23m object
 - method: "ebal" (entropy balancing)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 3-category (black, hispan, white)
 - estimand: ATE
 - covariates: age, educ, married, nodegree, re74
> summary(W2)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

          Min                                   Max
black  1.3975 |-----------|                 13.5172
hispan 1.2102 |---------------------------| 28.4321
white  0.8170 |-|                            3.9492

- [3mUnits with 5 greatest weights by group[23m:
                                               
            485     244     226     182     181
  black  6.3711  6.4409    7.09  8.9826 13.5172
            564     392     371     345     269
 hispan 17.4558 21.5908 22.4375 23.0408 28.4321
            599     589     531     457      68
  white  3.5134  3.5373  3.5799   3.643  3.9492

- [3mWeight statistics[23m:

        Coef of Var   MAD Entropy
black         0.590 0.413 257.113
hispan        0.609 0.439 166.092
white         0.371 0.306 235.398
overall       0.966 0.560 849.911

- [3mEffective Sample Sizes[23m:

             black hispan   white
Unweighted 243.000  72.00 299.000
Weighted   180.477  52.74 262.932
> bal.tab(W2)
[4mCall[24m
 weightit(formula = race ~ age + educ + married + nodegree + re74, data = lalonde, method = "ebal", estimand = "ATE", standardize = TRUE)

[4mBalance summary across all treatment pairs[24m
            Type Max.Diff.Adj
age      Contin.       0.0005
educ     Contin.       0.0012
married   Binary       0.0002
nodegree  Binary       0.0002
re74     Contin.       0.0001

[4mEffective sample sizes[24m
             black hispan   white
Unadjusted 243.000  72.00 299.000
Adjusted   180.477  52.74 262.932
> 
> #Balancing covariates with respect to re75 (continuous)
> (W3 <- weightit(re75 ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "ebal"))
A [3mweightit[23m object
 - method: "ebal" (entropy balancing)
 - number of obs.: 614
 - sampling weights: none
 - treatment: continuous
 - covariates: age, educ, married, nodegree, re74
> summary(W3)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

    Min                                   Max
all   0 |---------------------------| 10.5998

- [3mUnits with 5 greatest weights by group[23m:
                                        
        483    482    481    180     178
 all 4.5868 4.7046 4.8506 7.9044 10.5998

- [3mWeight statistics[23m:

    Coef of Var   MAD Entropy
all       0.765 0.434 123.443

- [3mEffective Sample Sizes[23m:

             Total
Unweighted 614.000
Weighted   387.412
> bal.tab(W3)
[4mCall[24m
 weightit(formula = re75 ~ age + educ + married + nodegree + re74, data = lalonde, method = "ebal")

[4mBalance Measures[24m
            Type Corr.Adj
age      Contin.       -0
educ     Contin.        0
married   Binary       -0
nodegree  Binary       -0
re74     Contin.       -0

[4mEffective sample sizes[24m
             Total
Unadjusted 614.000
Adjusted   387.412
> 
> 
> 
> 
> cleanEx()

detaching â€˜package:cobaltâ€™

> nameEx("method-ebcw")
> ### * method-ebcw
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: method_ebcw
> ### Title: Empirical Balancing Calibration Weighting
> ### Aliases: method_ebcw
> 
> ### ** Examples
> 
> library("cobalt")
 cobalt (Version 4.2.2, Build Date: 2020-06-26 15:50:03 UTC)
> data("lalonde", package = "cobalt")
> 
> #Balancing covariates between treatment groups (binary)
> (W1 <- weightit(treat ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "ebcw", estimand = "ATT"))
A [3mweightit[23m object
 - method: "ebcw" (empirical balancing calibration weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, re74
> summary(W1)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

           Min                                    Max
treated 1.0000                              || 1.0000
control 0.0001   ||                            0.0122

- [3mUnits with 5 greatest weights by group[23m:
                                          
              1     2      3      4      5
 treated      1     1      1      1      1
            595   589    409    296    269
 control 0.0079 0.008 0.0085 0.0094 0.0122

- [3mWeight statistics[23m:

        Coef of Var   MAD   Entropy
treated       0.000 0.000     0.000
control       0.839 0.707 -2454.216
overall       1.512 1.387   -18.885

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 429.000     185
Weighted   252.121     185
> bal.tab(W1)
[4mCall[24m
 weightit(formula = treat ~ age + educ + married + nodegree + re74, data = lalonde, method = "ebcw", estimand = "ATT")

[4mBalance Measures[24m
            Type Diff.Adj
age      Contin.       -0
educ     Contin.        0
married   Binary       -0
nodegree  Binary        0
re74     Contin.       -0

[4mEffective sample sizes[24m
           Control Treated
Unadjusted 429.000     185
Adjusted   252.121     185
> 
> #Balancing covariates with respect to race (multinomial)
> (W2 <- weightit(race ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "ebcw", estimand = "ATE"))
A [3mweightit[23m object
 - method: "ebcw" (empirical balancing calibration weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 3-category (black, hispan, white)
 - estimand: ATE
 - covariates: age, educ, married, nodegree, re74
> summary(W2)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

          Min                                  Max
black  0.0023 |-----------|                 0.0220
hispan 0.0020 |---------------------------| 0.0463
white  0.0013 |-|                           0.0064

- [3mUnits with 5 greatest weights by group[23m:
                                          
           485    244    226    182    181
  black 0.0104 0.0105 0.0115 0.0146  0.022
           564    392    371    345    269
 hispan 0.0284 0.0351 0.0366 0.0376 0.0463
           599    589    531    457     68
  white 0.0057 0.0058 0.0058 0.0059 0.0064

- [3mWeight statistics[23m:

        Coef of Var   MAD   Entropy
black         0.590 0.413 -1302.955
hispan        0.609 0.440  -296.150
white         0.371 0.306 -1684.182
overall       0.966 0.559 -3092.078

- [3mEffective Sample Sizes[23m:

             black hispan   white
Unweighted 243.000 72.000 299.000
Weighted   180.469 52.706 262.929
> bal.tab(W2)
[4mCall[24m
 weightit(formula = race ~ age + educ + married + nodegree + re74, data = lalonde, method = "ebcw", estimand = "ATE")

[4mBalance summary across all treatment pairs[24m
            Type Max.Diff.Adj
age      Contin.            0
educ     Contin.            0
married   Binary            0
nodegree  Binary            0
re74     Contin.            0

[4mEffective sample sizes[24m
             black hispan   white
Unadjusted 243.000 72.000 299.000
Adjusted   180.469 52.706 262.929
> 
> 
> 
> 
> cleanEx()

detaching â€˜package:cobaltâ€™

> nameEx("method-gbm")
> ### * method-gbm
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: method_gbm
> ### Title: Propensity Score Weighting Using Generalized Boosted Models
> ### Aliases: method_gbm
> 
> ### ** Examples
> 
> 
> library("cobalt")
 cobalt (Version 4.2.2, Build Date: 2020-06-26 15:50:03 UTC)
> data("lalonde", package = "cobalt")
> 
> #Balancing covariates between treatment groups (binary)
> (W1 <- weightit(treat ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "gbm", estimand = "ATE",
+                 stop.method = "es.max"))
A [3mweightit[23m object
 - method: "gbm" (generalized boosted modeling)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATE
 - covariates: age, educ, married, nodegree, re74
> summary(W1)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

           Min                                   Max
treated 1.1137 |---------------------------| 12.6196
control 1.0147 |----------------|             8.4841

- [3mUnits with 5 greatest weights by group[23m:
                                             
            182     177    124    172     115
 treated 9.4968 10.7796 11.052 11.052 12.6196
            608     592    569    585     374
 control 4.2564  5.3573 5.5494 5.5494  8.4841

- [3mWeight statistics[23m:

        Coef of Var   MAD Entropy
treated       0.848 0.514 209.885
control       0.460 0.233 149.288
overall       0.808 0.420 427.151

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 429.000 185.000
Weighted   354.256 107.839
> bal.tab(W1)
[4mCall[24m
 weightit(formula = treat ~ age + educ + married + nodegree + re74, data = lalonde, method = "gbm", estimand = "ATE", stop.method = "es.max")

[4mBalance Measures[24m
               Type Diff.Adj
prop.score Distance   0.7940
age         Contin.  -0.1999
educ        Contin.   0.0829
married      Binary  -0.0867
nodegree     Binary   0.0473
re74        Contin.  -0.0599

[4mEffective sample sizes[24m
           Control Treated
Unadjusted 429.000 185.000
Adjusted   354.256 107.839
> 
> ## Not run: 
> ##D #Balancing covariates with respect to race (multinomial)
> ##D (W2 <- weightit(race ~ age + educ + married +
> ##D                   nodegree + re74, data = lalonde,
> ##D                 method = "gbm", estimand = "ATT",
> ##D                 focal = "hispan", stop.method = "ks.mean"))
> ##D summary(W2)
> ##D bal.tab(W2)
> ##D 
> ##D #Balancing covariates with respect to re75 (continuous)
> ##D (W3 <- weightit(re75 ~ age + educ + married +
> ##D                   nodegree + re74, data = lalonde,
> ##D                 method = "gbm", use.kernel = TRUE,
> ##D                 stop.method = "p.rms", trim.at = .97))
> ##D summary(W3)
> ##D bal.tab(W3)
> ##D 
> ##D #Using a t(3) density and illustrating the search for
> ##D #more trees.
> ##D W4a <- weightit(re75 ~ age + educ + married +
> ##D                   nodegree + re74, data = lalonde,
> ##D                 method = "gbm", density = "dt_3",
> ##D                 stop.method = "p.max",
> ##D                 n.trees = 10000)
> ##D 
> ##D W4a$info$best.tree #10000; optimum hasn't been found
> ##D plot(W4a$info$tree.val) #decreasing at right edge
> ##D 
> ##D W4b <- weightit(re75 ~ age + educ + married +
> ##D                   nodegree + re74, data = lalonde,
> ##D                 method = "gbm", density = "dt_3",
> ##D                 stop.method = "p.max",
> ##D                 start.tree = 10000,
> ##D                 n.trees = 20000)
> ##D 
> ##D W4b$info$best.tree #13417; optimum has been found
> ##D plot(W4b$info$tree.val) #increasing at right edge
> ##D 
> ##D bal.tab(W4b)
> ##D 
> ## End(Not run)
> 
> 
> 
> cleanEx()

detaching â€˜package:cobaltâ€™

> nameEx("method-npcbps")
> ### * method-npcbps
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: method_npcbps
> ### Title: Nonparametric Covariate Balancing Propensity Score Weighting
> ### Aliases: method_npcbps
> 
> ### ** Examples
> 
> # Examples take a long time to run
> ## Not run: 
> ##D library("cobalt")
> ##D data("lalonde", package = "cobalt")
> ##D 
> ##D #Balancing covariates between treatment groups (binary)
> ##D (W1 <- weightit(treat ~ age + educ + married +
> ##D                   nodegree + re74, data = lalonde,
> ##D                 method = "npcbps", estimand = "ATE"))
> ##D summary(W1)
> ##D bal.tab(W1)
> ##D 
> ##D #Balancing covariates with respect to race (multinomial)
> ##D (W2 <- weightit(race ~ age + educ + married +
> ##D                   nodegree + re74, data = lalonde,
> ##D                 method = "npcbps", estimand = "ATE"))
> ##D summary(W2)
> ##D bal.tab(W2)
> ## End(Not run)
> 
> 
> 
> cleanEx()
> nameEx("method-optweight")
> ### * method-optweight
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: method_optweight
> ### Title: Optimization-Based Weighting
> ### Aliases: method_optweight
> 
> ### ** Examples
> 
> library("cobalt")
 cobalt (Version 4.2.2, Build Date: 2020-06-26 15:50:03 UTC)
> data("lalonde", package = "cobalt")
> 
> #Balancing covariates between treatment groups (binary)
> (W1 <- weightit(treat ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "optweight", estimand = "ATT",
+                 tols = 0))
A [3mweightit[23m object
 - method: "optweight" (targeted stable balancing weights)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, re74
> summary(W1)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

        Min                                  Max
treated   1           ||                  1.0000
control   0 |---------------------------| 3.0426

- [3mUnits with 5 greatest weights by group[23m:
                                           
              1      2      3      4      5
 treated      1      1      1      1      1
            589    411    409    296    269
 control 2.5261 2.5415 2.6434 2.7396 3.0426

- [3mWeight statistics[23m:

        Coef of Var   MAD Entropy
treated       0.000 0.000   0.000
control       0.788 0.697 168.579
overall       0.658 0.487 168.579

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 429.000     185
Weighted   264.881     185
> bal.tab(W1)
[4mCall[24m
 weightit(formula = treat ~ age + educ + married + nodegree + re74, data = lalonde, method = "optweight", estimand = "ATT", tols = 0)

[4mBalance Measures[24m
            Type Diff.Adj
age      Contin.       -0
educ     Contin.       -0
married   Binary       -0
nodegree  Binary        0
re74     Contin.       -0

[4mEffective sample sizes[24m
           Control Treated
Unadjusted 429.000     185
Adjusted   264.881     185
> 
> #Balancing covariates with respect to race (multinomial)
> (W2 <- weightit(race ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "optweight", estimand = "ATE",
+                 tols = .01))
A [3mweightit[23m object
 - method: "optweight" (targeted stable balancing weights)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 3-category (black, hispan, white)
 - estimand: ATE
 - covariates: age, educ, married, nodegree, re74
> summary(W2)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

          Min                                  Max
black  0.4429     |-----------------------| 3.5741
hispan 0.0000 |-------------------|         2.5848
white  0.2574   |---------|                 1.6593

- [3mUnits with 5 greatest weights by group[23m:
                                          
           485    190    184    182    181
  black 2.3351 2.3723 2.5586 2.8367 3.5741
           564    392    371    345    269
 hispan 2.0459 2.0984 2.1887 2.1982 2.5848
           599    589    531    324     68
  white 1.5706 1.5706 1.5725 1.5968 1.6593

- [3mWeight statistics[23m:

        Coef of Var   MAD Entropy
black         0.550 0.443  31.535
hispan        0.566 0.449  12.668
white         0.353 0.295  19.486
overall       0.466 0.372  63.689

- [3mEffective Sample Sizes[23m:

             black hispan   white
Unweighted 243.000 72.000 299.000
Weighted   186.758 54.695 266.013
> bal.tab(W2)
[4mCall[24m
 weightit(formula = race ~ age + educ + married + nodegree + re74, data = lalonde, method = "optweight", estimand = "ATE", tols = 0.01)

[4mBalance summary across all treatment pairs[24m
            Type Max.Diff.Adj
age      Contin.         0.01
educ     Contin.         0.01
married   Binary         0.01
nodegree  Binary         0.01
re74     Contin.         0.01

[4mEffective sample sizes[24m
             black hispan   white
Unadjusted 243.000 72.000 299.000
Adjusted   186.758 54.695 266.013
> 
> #Balancing covariates with respect to re75 (continuous)
> (W3 <- weightit(re75 ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "optweight", tols = .05))
A [3mweightit[23m object
 - method: "optweight" (targeted stable balancing weights)
 - number of obs.: 614
 - sampling weights: none
 - treatment: continuous
 - covariates: age, educ, married, nodegree, re74
> summary(W3)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

    Min                                 Max
all   0 |---------------------------| 3.966

- [3mUnits with 5 greatest weights by group[23m:
                                     
        483    482   200    180   178
 all 2.9566 3.0117 3.048 3.5934 3.966

- [3mWeight statistics[23m:

    Coef of Var   MAD Entropy
all       0.574 0.445 106.157

- [3mEffective Sample Sizes[23m:

             Total
Unweighted 614.000
Weighted   462.022
> bal.tab(W3)
[4mCall[24m
 weightit(formula = re75 ~ age + educ + married + nodegree + re74, data = lalonde, method = "optweight", tols = 0.05)

[4mBalance Measures[24m
            Type Corr.Adj
age      Contin.  -0.0087
educ     Contin.  -0.0106
married   Binary   0.0499
nodegree  Binary  -0.0451
re74     Contin.   0.0499

[4mEffective sample sizes[24m
             Total
Unadjusted 614.000
Adjusted   462.022
> 
> 
> 
> cleanEx()

detaching â€˜package:cobaltâ€™

> nameEx("method-ps")
> ### * method-ps
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: method_ps
> ### Title: Propensity Score Weighting Using Generalized Linear Models
> ### Aliases: method_ps
> 
> ### ** Examples
> 
> library("cobalt")
 cobalt (Version 4.2.2, Build Date: 2020-06-26 15:50:03 UTC)
> data("lalonde", package = "cobalt")
> 
> #Balancing covariates between treatment groups (binary)
> (W1 <- weightit(treat ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "ps", estimand = "ATT",
+                 link = "probit"))
A [3mweightit[23m object
 - method: "ps" (propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, re74
> summary(W1)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

           Min                                  Max
treated 1.0000                 ||            1.0000
control 0.0176 |---------------------------| 1.8338

- [3mUnits with 5 greatest weights by group[23m:
                                        
              1     2     3     4      5
 treated      1     1     1     1      1
            612   595   409   296    269
 control 1.2781 1.351 1.412 1.518 1.8338

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.000 0.000    0.000
control       0.804 0.691 -224.549
overall       0.648 0.597 -160.309

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 429.000     185
Weighted   260.834     185
> bal.tab(W1)
[4mCall[24m
 weightit(formula = treat ~ age + educ + married + nodegree + re74, data = lalonde, method = "ps", estimand = "ATT", link = "probit")

[4mBalance Measures[24m
               Type Diff.Adj
prop.score Distance   0.0252
age         Contin.   0.0716
educ        Contin.  -0.0565
married      Binary   0.0058
nodegree     Binary   0.0128
re74        Contin.  -0.0507

[4mEffective sample sizes[24m
           Control Treated
Unadjusted 429.000     185
Adjusted   260.834     185
> 
> #Balancing covariates with respect to race (multinomial)
> (W2 <- weightit(race ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "ps", estimand = "ATE"))
A [3mweightit[23m object
 - method: "ps" (propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 3-category (black, hispan, white)
 - estimand: ATE
 - covariates: age, educ, married, nodegree, re74
> summary(W2)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

          Min                                   Max
black  1.4528 |---------------------------| 30.8071
hispan 1.7990  |---------------------|      25.9532
white  1.1123 |-|                            3.9770

- [3mUnits with 5 greatest weights by group[23m:
                                              
            485     231    226     182     181
  black   7.532  7.6243 8.5246 12.3509 30.8071
            564     392    371     345     269
 hispan 15.9922 16.7517 18.784 23.4106 25.9532
            599     589    437     432     404
  white   3.686  3.6864  3.712  3.7842   3.977

- [3mWeight statistics[23m:

        Coef of Var   MAD Entropy
black         0.890 0.426 277.695
hispan        0.541 0.404 162.909
white         0.382 0.317 235.214
overall       0.983 0.570 854.672

- [3mEffective Sample Sizes[23m:

             black hispan   white
Unweighted 243.000 72.000 299.000
Weighted   135.796 55.862 261.019
> bal.tab(W2)
[4mCall[24m
 weightit(formula = race ~ age + educ + married + nodegree + re74, data = lalonde, method = "ps", estimand = "ATE")

[4mBalance summary across all treatment pairs[24m
            Type Max.Diff.Adj
age      Contin.       0.0419
educ     Contin.       0.1276
married   Binary       0.0500
nodegree  Binary       0.0605
re74     Contin.       0.2023

[4mEffective sample sizes[24m
             black hispan   white
Unadjusted 243.000 72.000 299.000
Adjusted   135.796 55.862 261.019
> 
> #Balancing covariates with respect to re75 (continuous)
> (W3 <- weightit(re75 ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "ps", use.kernel = TRUE))
A [3mweightit[23m object
 - method: "ps" (propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: continuous
 - covariates: age, educ, married, nodegree, re74
> summary(W3)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

      Min                                   Max
all 0.088 |---------------------------| 83.1017

- [3mUnits with 5 greatest weights by group[23m:
                                          
        485     484    483     482     481
 all 56.933 56.9865 70.237 77.1173 83.1017

- [3mWeight statistics[23m:

    Coef of Var   MAD  Entropy
all       2.908 1.049 1278.452

- [3mEffective Sample Sizes[23m:

             Total
Unweighted 614.000
Weighted    65.032
> bal.tab(W3)
[4mCall[24m
 weightit(formula = re75 ~ age + educ + married + nodegree + re74, data = lalonde, method = "ps", use.kernel = TRUE)

[4mBalance Measures[24m
            Type Corr.Adj
age      Contin.  -0.0501
educ     Contin.   0.0016
married   Binary  -0.0427
nodegree  Binary  -0.0196
re74     Contin.  -0.0773

[4mEffective sample sizes[24m
             Total
Unadjusted 614.000
Adjusted    65.032
> 
> 
> 
> cleanEx()

detaching â€˜package:cobaltâ€™

> nameEx("method-super")
> ### * method-super
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: method_super
> ### Title: Propensity Score Weighting Using SuperLearner
> ### Aliases: method_super
> 
> ### ** Examples
> 
> library("cobalt")
 cobalt (Version 4.2.2, Build Date: 2020-06-26 15:50:03 UTC)
> data("lalonde", package = "cobalt")
> 
> #Balancing covariates between treatment groups (binary)
> (W1 <- weightit(treat ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "super", estimand = "ATT",
+                 SL.library = c("SL.glm", "SL.stepAIC",
+                                "SL.glm.interaction")))
Loading required package: nnls
A [3mweightit[23m object
 - method: "super" (propensity score weighting with SuperLearner)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, re74
> summary(W1)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

           Min                                  Max
treated 1.0000      ||                       1.0000
control 0.0059 |---------------------------| 5.8187

- [3mUnits with 5 greatest weights by group[23m:
                                          
              1     2      3      4      5
 treated      1     1      1      1      1
            589   411    409    296    269
 control 2.4398 2.529 2.7686 3.3939 5.8187

- [3mWeight statistics[23m:

        Coef of Var  MAD  Entropy
treated       0.000 0.00    0.000
control       1.130 0.74 -175.084
overall       0.803 0.61 -124.448

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 429.000     185
Weighted   188.578     185
> bal.tab(W1)
[4mCall[24m
 weightit(formula = treat ~ age + educ + married + nodegree + re74, data = lalonde, method = "super", estimand = "ATT", SL.library = c("SL.glm", "SL.stepAIC", "SL.glm.interaction"))

[4mBalance Measures[24m
               Type Diff.Adj
prop.score Distance   0.0533
age         Contin.  -0.1477
educ        Contin.   0.0161
married      Binary  -0.0049
nodegree     Binary   0.0115
re74        Contin.  -0.0247

[4mEffective sample sizes[24m
           Control Treated
Unadjusted 429.000     185
Adjusted   188.578     185
> 
> #Balancing covariates with respect to race (multinomial)
> (W2 <- weightit(race ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "super", estimand = "ATE",
+                 SL.library = c("SL.glm", "SL.stepAIC",
+                                "SL.glm.interaction")))
A [3mweightit[23m object
 - method: "super" (propensity score weighting with SuperLearner)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 3-category (black, hispan, white)
 - estimand: ATE
 - covariates: age, educ, married, nodegree, re74
> summary(W2)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

          Min                                   Max
black  1.4243 |-----------------|           12.5777
hispan 2.0160  |--------------------------| 18.3923
white  1.0726 |----|                         4.7898

- [3mUnits with 5 greatest weights by group[23m:
                                             
           485     190    184     182     181
  black 7.2537  7.9554 9.8081  11.711 12.5777
           512     392    346     345     216
 hispan 14.234 14.2911 14.361 14.4573 18.3923
           589     457    409     296      23
  white 4.1355  4.1807 4.2664  4.6246  4.7898

- [3mWeight statistics[23m:

        Coef of Var   MAD Entropy
black         0.615 0.384 249.954
hispan        0.416 0.341 157.861
white         0.390 0.321 233.599
overall       0.858 0.555 815.006

- [3mEffective Sample Sizes[23m:

             black hispan   white
Unweighted 243.000 72.000 299.000
Weighted   176.489 61.491 259.652
> bal.tab(W2)
[4mCall[24m
 weightit(formula = race ~ age + educ + married + nodegree + re74, data = lalonde, method = "super", estimand = "ATE", SL.library = c("SL.glm", "SL.stepAIC", "SL.glm.interaction"))

[4mBalance summary across all treatment pairs[24m
            Type Max.Diff.Adj
age      Contin.       0.1773
educ     Contin.       0.0720
married   Binary       0.0298
nodegree  Binary       0.0157
re74     Contin.       0.0342

[4mEffective sample sizes[24m
             black hispan   white
Unadjusted 243.000 72.000 299.000
Adjusted   176.489 61.491 259.652
> 
> #Balancing covariates with respect to re75 (continuous)
> #assuming t(8) conditional density for treatment
> (W3 <- weightit(re75 ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "super", density = "dt_8",
+                 SL.library = c("SL.glm", "SL.ridge",
+                                "SL.glm.interaction")))
A [3mweightit[23m object
 - method: "super" (propensity score weighting with SuperLearner)
 - number of obs.: 614
 - sampling weights: none
 - treatment: continuous
 - covariates: age, educ, married, nodegree, re74
> summary(W3)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

       Min                                   Max
all 0.0437 |---------------------------| 19.9146

- [3mUnits with 5 greatest weights by group[23m:
                                         
        485     484   483     431     354
 all 9.2793 16.7462 17.81 18.1481 19.9146

- [3mWeight statistics[23m:

    Coef of Var   MAD Entropy
all       1.306 0.499 337.575

- [3mEffective Sample Sizes[23m:

             Total
Unweighted 614.000
Weighted   227.274
> bal.tab(W3)
[4mCall[24m
 weightit(formula = re75 ~ age + educ + married + nodegree + re74, data = lalonde, method = "super", density = "dt_8", SL.library = c("SL.glm", "SL.ridge", "SL.glm.interaction"))

[4mBalance Measures[24m
            Type Corr.Adj
age      Contin.   0.0288
educ     Contin.   0.0329
married   Binary   0.0619
nodegree  Binary  -0.0578
re74     Contin.   0.0406

[4mEffective sample sizes[24m
             Total
Unadjusted 614.000
Adjusted   227.274
> 
> #Balancing covariates between treatment groups (binary)
> # using balance SuperLearner to minimize the average
> # KS statistic
> (W4 <- weightit(treat ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "super", estimand = "ATT",
+                 SL.library = c("SL.glm", "SL.stepAIC",
+                                "SL.lda"),
+                 SL.method = "method.balance",
+                 stop.method = "ks.mean"))
A [3mweightit[23m object
 - method: "super" (propensity score weighting with SuperLearner)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, re74
> summary(W4)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

           Min                                  Max
treated 1.0000               ||              1.0000
control 0.0222 |---------------------------| 2.0438

- [3mUnits with 5 greatest weights by group[23m:
                                           
              1      3      4      8     10
 treated      1      1      1      1      1
            595    411    409    296    269
 control 1.3303 1.4365 1.5005 1.6369 2.0438

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.000 0.000    0.000
control       0.823 0.701 -221.034
overall       0.657 0.604 -157.815

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 429.000     185
Weighted   255.989     185
> bal.tab(W4)
[4mCall[24m
 weightit(formula = treat ~ age + educ + married + nodegree + re74, data = lalonde, method = "super", estimand = "ATT", SL.library = c("SL.glm", "SL.stepAIC", "SL.lda"), SL.method = "method.balance", stop.method = "ks.mean")

[4mBalance Measures[24m
               Type Diff.Adj
prop.score Distance   0.0199
age         Contin.   0.0459
educ        Contin.  -0.0360
married      Binary   0.0044
nodegree     Binary   0.0080
re74        Contin.  -0.0275

[4mEffective sample sizes[24m
           Control Treated
Unadjusted 429.000     185
Adjusted   255.989     185
> 
> 
> 
> cleanEx()

detaching â€˜package:nnlsâ€™, â€˜package:cobaltâ€™

> nameEx("method-twang")
> ### * method-twang
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: method_twang
> ### Title: Propensity Score Weighting Using Generalized Boosted Models with
> ###   TWANG
> ### Aliases: method_twang
> 
> ### ** Examples
> 
> # Examples take a while to run
> ## Not run: 
> ##D library("cobalt")
> ##D data("lalonde", package = "cobalt")
> ##D 
> ##D #Balancing covariates between treatment groups (binary)
> ##D (W1 <- weightit(treat ~ age + educ + married +
> ##D                   nodegree + re74, data = lalonde,
> ##D                 method = "twang", estimand = "ATT",
> ##D                 stop.method = "es.max"))
> ##D summary(W1)
> ##D bal.tab(W1)
> ##D 
> ##D #Balancing covariates with respect to race (multinomial)
> ##D (W2 <- weightit(race ~ age + educ + married +
> ##D                   nodegree + re74, data = lalonde,
> ##D                 method = "twang", estimand = "ATE",
> ##D                 stop.method = "ks.mean"))
> ##D summary(W2)
> ##D bal.tab(W2)
> ##D 
> ##D #Balancing covariates with respect to re75 (continuous)
> ##D (W3 <- weightit(re75 ~ age + educ + married +
> ##D                   nodegree + re74, data = lalonde,
> ##D                 method = "twang", use.kernel = TRUE,
> ##D                 stop.method = "p.max"))
> ##D summary(W3)
> ##D bal.tab(W3)
> ## End(Not run)
> 
> 
> 
> cleanEx()
> nameEx("method-user")
> ### * method-user
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: method_user
> ### Title: User-Defined Functions for Estimating Weights
> ### Aliases: method_user
> 
> ### ** Examples
> 
> 
> library("cobalt")
 cobalt (Version 4.2.2, Build Date: 2020-06-26 15:50:03 UTC)
> data("lalonde", package = "cobalt")
> 
> #A user-defined version of method = "ps"
> my.ps <- function(treat, covs, estimand, focal = NULL) {
+   covs <- make_full_rank(covs)
+   d <- data.frame(treat, covs)
+   f <- formula(d)
+   ps <- glm(f, data = d, family = "binomial")$fitted
+   w <- get_w_from_ps(ps, treat = treat, estimand = estimand,
+                      focal = focal)
+ 
+   return(list(w = w, ps = ps))
+ }
> 
> #Balancing covariates between treatment groups (binary)
> (W1 <- weightit(treat ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = my.ps, estimand = "ATT"))
A [3mweightit[23m object
 - method: "my.ps" (a user-defined method)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, re74
> summary(W1)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

           Min                                  Max
treated 1.0000               ||              1.0000
control 0.0222 |---------------------------| 2.0438

- [3mUnits with 5 greatest weights by group[23m:
                                           
              1      3      4      5      7
 treated      1      1      1      1      1
            595    411    409    296    269
 control 1.3303 1.4365 1.5005 1.6369 2.0438

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.000 0.000    0.000
control       0.823 0.701 -221.034
overall       0.657 0.604 -157.815

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 429.000     185
Weighted   255.989     185
> bal.tab(W1)
[4mCall[24m
 weightit(formula = treat ~ age + educ + married + nodegree + re74, data = lalonde, method = my.ps, estimand = "ATT")

[4mBalance Measures[24m
               Type Diff.Adj
prop.score Distance   0.0199
age         Contin.   0.0459
educ        Contin.  -0.0360
married      Binary   0.0044
nodegree     Binary   0.0080
re74        Contin.  -0.0275

[4mEffective sample sizes[24m
           Control Treated
Unadjusted 429.000     185
Adjusted   255.989     185
> 
> #Balancing covariates for longitudinal treatments
> # my.ps is used at each time point.
> library("twang")
Loading required package: gbm
Loaded gbm 2.1.5
Loading required package: survey
Loading required package: grid
Loading required package: Matrix
Loading required package: survival

Attaching package: â€˜surveyâ€™

The following object is masked from â€˜package:graphicsâ€™:

    dotchart

Loading required package: xtable
Loading required package: lattice
Loading required package: latticeExtra
> data("iptwExWide", package = "twang")
> (W2 <- weightitMSM(list(tx1 ~ age + gender + use0,
+                         tx2 ~ tx1 + use1 + age + gender + use0,
+                         tx3 ~ tx2 + use2 + tx1 + use1 + age + gender + use0),
+                    data = iptwExWide,
+                    method = my.ps))
A [3mweightitMSM[23m object
 - method: "my.ps" (a user-defined method)
 - number of obs.: 1000
 - sampling weights: none
 - number of time points: 3 (tx1, tx2, tx3)
 - treatment: 
    + time 1: 2-category
    + time 2: 2-category
    + time 3: 2-category
 - covariates: 
    + baseline: age, gender, use0
    + after time 1: tx1, use1, age, gender, use0
    + after time 2: tx2, use2, tx1, use1, age, gender, use0
> summary(W2)
                 [4mSummary of weights[24m

[9m                      [29m[3m Time 1 [23m[9m                      [29m
- [3mWeight ranges[23m:

           Min                                   Max
treated 1.6667 |---|                         15.5292
control 2.6123 |---------------------------| 82.2349

- [3mUnits with 5 greatest weights by group[23m:
                                                
             642     350     324     299     228
 treated 13.4464 13.6233 13.7059  14.436 15.5292
             288     176     147      72      52
 control 44.8027 46.1355 58.4164 79.8919 82.2349

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.481 0.376 1317.833
control       0.768 0.494  819.850
overall       0.857 0.520 2314.014

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted  294.00 706.000
Weighted    185.18 573.598

[9m                      [29m[3m Time 2 [23m[9m                      [29m
- [3mWeight ranges[23m:

           Min                                   Max
treated 1.6667 |---------------------------| 82.2349
control 2.6123 |--------------------------|  79.8919

- [3mUnits with 5 greatest weights by group[23m:
                                                
             497     338     290     286      22
 treated  33.371 34.7405 42.9442 58.4164 82.2349
             265     139     103      47      39
 control 39.7862 42.2256 44.8027 46.1355 79.8919

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.960 0.653 1218.348
control       0.737 0.384 1095.956
overall       0.857 0.520 2314.014

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 492.000 508.000
Weighted   318.903 264.487

[9m                      [29m[3m Time 3 [23m[9m                      [29m
- [3mWeight ranges[23m:

           Min                                   Max
treated 1.6667 |-------------|               44.8027
control 2.6123 |---------------------------| 82.2349

- [3mUnits with 5 greatest weights by group[23m:
                                                
             548     450     382     124      67
 treated  26.003  26.471 28.0582 39.7862 44.8027
             403     264     226     224     110
 control 42.9442 46.1355 58.4164 79.8919 82.2349

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.773 0.565 1267.537
control       0.873 0.469 1023.060
overall       0.857 0.520 2314.014

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 415.000 585.000
Weighted   235.672 366.399

> bal.tab(W2)
[4mCall[24m
 weightitMSM(formula.list = list(tx1 ~ age + gender + use0, tx2 ~ tx1 + use1 + age + gender + use0, tx3 ~ tx2 + use2 + tx1 + use1 + age + gender + use0), data = iptwExWide, method = my.ps)

[4mBalance summary across all time points[24m
             Times     Type Max.Diff.Adj
prop.score 1, 2, 3 Distance       0.0251
age        1, 2, 3  Contin.       0.0703
gender     1, 2, 3   Binary       0.0263
use0       1, 2, 3  Contin.       0.0558
tx1           2, 3   Binary       0.0171
use1          2, 3  Contin.       0.0316
tx2              3   Binary       0.0085
use2             3  Contin.       0.0315

[4mEffective sample sizes[24m
 - [3mTime 1[23m
           Control Treated
Unadjusted  294.00 706.000
Adjusted    185.18 573.598
 - [3mTime 2[23m
           Control Treated
Unadjusted 492.000 508.000
Adjusted   318.903 264.487
 - [3mTime 3[23m
           Control Treated
Unadjusted 415.000 585.000
Adjusted   235.672 366.399
> 
> # Kernel balancing using the KBAL package, available
> # using devtools::install_github("chadhazlett/KBAL").
> # Only the ATT and ATC are available. Use 'kbal.method'
> # instead of 'method' in weightit() to choose between
> # "ebal" and "el".
> 
> ## Not run: 
> ##D kbal.fun <- function(treat, covs, estimand, focal, ...) {
> ##D     args <- list(...)
> ##D     if (is_not_null(focal))
> ##D         treat <- as.numeric(treat == focal)
> ##D     else if (estimand != "ATT")
> ##D         stop("estimand must be 'ATT' or 'ATC'.", call. = FALSE)
> ##D     if ("kbal.method" %in% names(args)) {
> ##D         names(args)[names(args) == "kbal.method"] <- "method"
> ##D     }
> ##D     args[names(args) %nin% setdiff(names(formals(KBAL::kbal)),
> ##D         c("X", "D"))] <- NULL
> ##D     k.out <- do.call(KBAL::kbal, c(list(X = covs, D = treat),
> ##D         args))
> ##D     w <- k.out$w
> ##D     return(list(w = w))
> ##D }
> ##D 
> ##D (Wk <- weightit(treat ~ age + educ + married +
> ##D                 nodegree + re74, data = lalonde,
> ##D                 method = kbal.fun, estimand = "ATT",
> ##D                 kbal.method = "ebal"))
> ##D summary(Wk)
> ##D bal.tab(Wk, disp.ks = TRUE)
> ## End(Not run)
> 
> 
> 
> cleanEx()

detaching â€˜package:twangâ€™, â€˜package:latticeExtraâ€™, â€˜package:latticeâ€™,
  â€˜package:xtableâ€™, â€˜package:surveyâ€™, â€˜package:survivalâ€™,
  â€˜package:Matrixâ€™, â€˜package:gridâ€™, â€˜package:gbmâ€™, â€˜package:cobaltâ€™

> nameEx("ps.cont")
> ### * ps.cont
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: ps.cont
> ### Title: Generalized Propensity Score Estimation using GBM
> ### Aliases: ps.cont gbm.cont summary.ps.cont plot.ps.cont boxplot.ps.cont
> 
> ### ** Examples
> 
> # Examples take a long time
> ## Not run: 
> ##D library("cobalt")
> ##D data("lalonde", package = "cobalt")
> ##D 
> ##D #Balancing covariates with respect to re75
> ##D psc.out <- ps.cont(re75 ~ age + educ + married +
> ##D                 nodegree + race + re74, data = lalonde,
> ##D                 stop.method = c("p.mean", "p.max"),
> ##D                 use.optimize = 2)
> ##D summary(psc.out)
> ##D twang::bal.table(psc.out) #twang's bal.table
> ## End(Not run)
> 
> 
> 
> cleanEx()
> nameEx("sbps")
> ### * sbps
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: sbps
> ### Title: Subgroup Balancing Propensity Score
> ### Aliases: sbps SBPS summary.weightit.sbps print.weightit.sbps
> ###   print.summary.weightit.sbps
> 
> ### ** Examples
> 
> library("cobalt")
 cobalt (Version 4.2.2, Build Date: 2020-06-26 15:50:03 UTC)
> data("lalonde", package = "cobalt")
> 
> #Balancing covariates between treatment groups within races
> (W1 <- weightit(treat ~ age + educ + married +
+                 nodegree + race + re74, data = lalonde,
+                 method = "ps", estimand = "ATT"))
A [3mweightit[23m object
 - method: "ps" (propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, race, re74
> 
> (W2 <- weightit(treat ~ age + educ + married +
+                 nodegree + race + re74, data = lalonde,
+                 method = "ps", estimand = "ATT",
+                 by = "race"))
A [3mweightit[23m object
 - method: "ps" (propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, race, re74
 - by: race
> S <- sbps(W1, W2)
> print(S)
A weightit.sbps object
 - method: "ps" (propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, race, re74
 - moderator: race (3 subgroups)
> summary(S)
Summary of weights:

 - Overall vs. subgroup proportion contribution:
         race = black race = hispan race = white
Overall             0             0            0
Subgroup            1             1            1

 - - - - - - - Subgroup race = black - - - - - - -
- Weight ranges:
          Min                                  Max
treated 1.000      ||                       1.0000
control 0.466 |---------------------------| 3.5903

- Units with 5 greatest weights by group:
                                          
              1      2     3      4      5
 treated      1      1     1      1      1
            221    228   188    185    174
 control 2.9494 2.9494 3.006 3.0637 3.5903

         Ratio Coef of Var
treated 1.0000      0.0000
control 7.7042      0.4250
overall 7.7042      0.4616

- Effective Sample Sizes:
           Control Treated
Unweighted  87.000     156
Weighted    73.818     156

 - - - - - - - Subgroup race = hispan - - - - - - -
- Weight ranges:
           Min                                    Max
treated 1.0000                              || 1.0000
control 0.0209   |------------|                0.5046

- Units with 5 greatest weights by group:
                                           
              2      3      4      5      7
 treated      1      1      1      1      1
             56     54     49     48     47
 control 0.4117 0.4767 0.4835 0.4968 0.5046

          Ratio Coef of Var
treated  1.0000      0.0000
control 24.1741      0.7143
overall 47.9120      1.0352

- Effective Sample Sizes:
           Control Treated
Unweighted  61.000      11
Weighted    40.616      11

 - - - - - - - Subgroup race = white - - - - - - -
- Weight ranges:
           Min                                   Max
treated 1.0000                              || 1.000
control 0.0002   |---------|                   0.385

- Units with 5 greatest weights by group:
                                          
              1      2      3      4     5
 treated      1      1      1      1     1
            289    287    285    280   267
 control 0.2393 0.2699 0.2937 0.2956 0.385

           Ratio Coef of Var
treated    1.000      0.0000
control 1825.568      1.1538
overall 4742.156      1.9499

- Effective Sample Sizes:
           Control Treated
Unweighted 281.000      18
Weighted   120.777      18
> bal.tab(S, cluster = "race")
[4mCall[24m
 sbps(obj = W1, obj2 = W2)

[4mBalance by cluster[24m

 - - - [3mCluster: black[23m - - - 
[4mBalance Measures[24m
               Type Diff.Adj
prop.score Distance   0.0016
age         Contin.   0.0126
educ        Contin.  -0.0332
married      Binary   0.0030
nodegree     Binary   0.0062
re74        Contin.  -0.0826

[4mEffective sample sizes[24m
           Control Treated
Unadjusted  87.000     156
Adjusted    73.818     156

 - - - [3mCluster: hispan[23m - - - 
[4mBalance Measures[24m
               Type Diff.Adj
prop.score Distance  -0.2678
age         Contin.   0.1196
educ        Contin.  -0.0756
married      Binary   0.0217
nodegree     Binary   0.0018
re74        Contin.   0.0114

[4mEffective sample sizes[24m
           Control Treated
Unadjusted  61.000      11
Adjusted    40.616      11

 - - - [3mCluster: white[23m - - - 
[4mBalance Measures[24m
               Type Diff.Adj
prop.score Distance   0.0652
age         Contin.   0.0191
educ        Contin.  -0.0185
married      Binary  -0.0015
nodegree     Binary   0.0039
re74        Contin.  -0.0117

[4mEffective sample sizes[24m
           Control Treated
Unadjusted 281.000      18
Adjusted   120.777      18
 - - - - - - - - - - - - - - 

> 
> #Could also have run
> #  sbps(W1, moderator = "race")
> 
> S_ <- sbps(W1, W2, smooth = TRUE)
> print(S_)
A weightit.sbps object
 - method: "ps" (propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, race, re74
 - moderator: race (3 subgroups)
> summary(S_)
Summary of weights:

 - Overall vs. subgroup proportion contribution:
         race = black race = hispan race = white
Overall          0.17          0.25            0
Subgroup         0.83          0.75            1

 - - - - - - - Subgroup race = black - - - - - - -
- Weight ranges:
           Min                                  Max
treated 1.0000      ||                       1.0000
control 0.4654 |---------------------------| 3.5703

- Units with 5 greatest weights by group:
                                           
              1      2      3      4      5
 treated      1      1      1      1      1
            221    228    188    185    174
 control 2.9787 2.9787 3.0338 3.0899 3.5703

         Ratio Coef of Var
treated 1.0000      0.0000
control 7.6708      0.4264
overall 7.6708      0.4625

- Effective Sample Sizes:
           Control Treated
Unweighted  87.000     156
Weighted    73.744     156

 - - - - - - - Subgroup race = hispan - - - - - - -
- Weight ranges:
           Min                                    Max
treated 1.0000                              || 1.0000
control 0.0254   |-----------|                 0.4743

- Units with 5 greatest weights by group:
                                           
              2      3      4      6      7
 treated      1      1      1      1      1
             56     54     48     47     28
 control 0.3908 0.4496 0.4557 0.4704 0.4743

          Ratio Coef of Var
treated  1.0000      0.0000
control 18.6516      0.6795
overall 39.3245      1.0314

- Effective Sample Sizes:
           Control Treated
Unweighted   61.00      11
Weighted     41.95      11

 - - - - - - - Subgroup race = white - - - - - - -
- Weight ranges:
           Min                                   Max
treated 1.0000                              || 1.000
control 0.0002   |---------|                   0.385

- Units with 5 greatest weights by group:
                                          
              1      2      3      4     5
 treated      1      1      1      1     1
            289    287    285    280   267
 control 0.2393 0.2699 0.2937 0.2956 0.385

           Ratio Coef of Var
treated    1.000      0.0000
control 1825.568      1.1538
overall 4742.156      1.9499

- Effective Sample Sizes:
           Control Treated
Unweighted 281.000      18
Weighted   120.777      18
> bal.tab(S_, cluster = "race")
[4mCall[24m
 sbps(obj = W1, obj2 = W2, smooth = TRUE)

[4mBalance by cluster[24m

 - - - [3mCluster: black[23m - - - 
[4mBalance Measures[24m
               Type Diff.Adj
prop.score Distance   0.0019
age         Contin.   0.0388
educ        Contin.  -0.0305
married      Binary   0.0096
nodegree     Binary   0.0086
re74        Contin.  -0.0561

[4mEffective sample sizes[24m
           Control Treated
Unadjusted  87.000     156
Adjusted    73.744     156

 - - - [3mCluster: hispan[23m - - - 
[4mBalance Measures[24m
               Type Diff.Adj
prop.score Distance  -0.1909
age         Contin.   0.0167
educ        Contin.  -0.0654
married      Binary   0.0314
nodegree     Binary   0.0084
re74        Contin.  -0.0175

[4mEffective sample sizes[24m
           Control Treated
Unadjusted   61.00      11
Adjusted     41.95      11

 - - - [3mCluster: white[23m - - - 
[4mBalance Measures[24m
               Type Diff.Adj
prop.score Distance   0.0652
age         Contin.   0.0191
educ        Contin.  -0.0185
married      Binary  -0.0015
nodegree     Binary   0.0039
re74        Contin.  -0.0117

[4mEffective sample sizes[24m
           Control Treated
Unadjusted 281.000      18
Adjusted   120.777      18
 - - - - - - - - - - - - - - 

> 
> 
> 
> 
> cleanEx()

detaching â€˜package:cobaltâ€™

> nameEx("summary.weightit")
> ### * summary.weightit
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: summary.weightit
> ### Title: Print and Summarize Output
> ### Aliases: print.summary.weightit plot.summary.weightit summary.weightit
> ###   print.summary.weightitMSM summary.weightitMSM
> 
> ### ** Examples
> 
> # See example at ?weightit or ?weightitMSM
> 
> 
> 
> cleanEx()
> nameEx("trim")
> ### * trim
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: trim
> ### Title: Trim Large Weights
> ### Aliases: trim trim.weightit trim.numeric
> 
> ### ** Examples
> 
> library("cobalt")
 cobalt (Version 4.2.2, Build Date: 2020-06-26 15:50:03 UTC)
> data("lalonde", package = "cobalt")
> 
> (W <- weightit(treat ~ age + educ + married +
+                  nodegree + re74, data = lalonde,
+                method = "ps", estimand = "ATT"))
A [3mweightit[23m object
 - method: "ps" (propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, re74
> summary(W)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

           Min                                  Max
treated 1.0000               ||              1.0000
control 0.0222 |---------------------------| 2.0438

- [3mUnits with 5 greatest weights by group[23m:
                                           
              1      3      4      8     10
 treated      1      1      1      1      1
            595    411    409    296    269
 control 1.3303 1.4365 1.5005 1.6369 2.0438

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.000 0.000    0.000
control       0.823 0.701 -221.034
overall       0.657 0.604 -157.815

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 429.000     185
Weighted   255.989     185
> 
> #Trimming the top and bottom 5 weights
> trim(W, at = 5, lower = TRUE)
Trimming the top and bottom 5 weights where treat â‰  1.
A [3mweightit[23m object
 - method: "ps" (propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, re74
 - weights trimmed at the top and bottom 5 
> 
> #Trimming at 90th percentile
> (W.trim <- trim(W, at = .9))
Trimming weights where treat is not 1 to 90%.
A [3mweightit[23m object
 - method: "ps" (propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, re74
 - weights trimmed at 90% 
> 
> summary(W.trim)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

           Min                                    Max
treated 1.0000                              || 1.0000
control 0.0222   |-------------------------|   0.9407

- [3mUnits with 5 greatest weights by group[23m:
                                           
              1      3      4      8     10
 treated      1      1      1      1      1
            264    269    285    296    303
 control 0.9407 0.9407 0.9407 0.9407 0.9407

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.000 0.000    0.000
control       0.766 0.682 -250.272
overall       0.641 0.597 -175.047

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 429.000     185
Weighted   270.578     185
> #Note that only the control weights were trimmed
> 
> #Trimming a numeric vector of weights
> weights <- cobalt::get.w(W)
> 
> all.equal(trim(weights, at = .9, treat = lalonde$treat),
+           W.trim$weights)
Trimming weights where treat is not 1 to 90%.
[1] TRUE
> 
> #Using made up data and as.weightit()
> treat <- rbinom(500, 1, .3)
> weights <- rchisq(500, df = 2)
> W <- as.weightit(weights= weights, treat = treat,
+                  estimand = "ATE")
> summary(W)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

           Min                                   Max
treated 0.0000 |------------|                 7.6018
control 0.0246 |---------------------------| 15.2679

- [3mUnits with 5 greatest weights by group[23m:
                                             
            405    308    300     139      46
 treated 6.3614 6.7201 6.8311  7.0867  7.6018
            490    221    118      32      16
 control 8.9805 9.4039 9.6949 11.8394 15.2679

- [3mWeight statistics[23m:

        Coef of Var   MAD Entropy
treated       0.995 0.746 133.993
control       1.055 0.788 432.162
overall       1.053 0.782 573.236

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 355.000 145.000
Weighted   168.315  73.125
> summary(trim(W, at = .95))
Trimming weights to 95%.
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

           Min                                  Max
treated 0.0000 |---------------------------| 6.4201
control 0.0246 |---------------------------| 6.4201

- [3mUnits with 5 greatest weights by group[23m:
                                           
            405     46    139    300    308
 treated 6.3614 6.4201 6.4201 6.4201 6.4201
             16     19     32     81     90
 control 6.4201 6.4201 6.4201 6.4201 6.4201

- [3mWeight statistics[23m:

        Coef of Var   MAD Entropy
treated       0.970 0.741 130.850
control       0.943 0.763 396.286
overall       0.956 0.760 531.487

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 355.000 145.000
Weighted   188.199  74.936
> 
> 
> 
> cleanEx()

detaching â€˜package:cobaltâ€™

> nameEx("weightit")
> ### * weightit
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: weightit
> ### Title: Generate Balancing Weights
> ### Aliases: weightit WeightIt print.weightit
> 
> ### ** Examples
> 
> library("cobalt")
 cobalt (Version 4.2.2, Build Date: 2020-06-26 15:50:03 UTC)
> data("lalonde", package = "cobalt")
> 
> #Balancing covariates between treatment groups (binary)
> (W1 <- weightit(treat ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "ps", estimand = "ATT"))
A [3mweightit[23m object
 - method: "ps" (propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 2-category
 - estimand: ATT (focal: 1)
 - covariates: age, educ, married, nodegree, re74
> summary(W1)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

           Min                                  Max
treated 1.0000               ||              1.0000
control 0.0222 |---------------------------| 2.0438

- [3mUnits with 5 greatest weights by group[23m:
                                           
              1      3      4      8     10
 treated      1      1      1      1      1
            595    411    409    296    269
 control 1.3303 1.4365 1.5005 1.6369 2.0438

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.000 0.000    0.000
control       0.823 0.701 -221.034
overall       0.657 0.604 -157.815

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 429.000     185
Weighted   255.989     185
> bal.tab(W1)
[4mCall[24m
 weightit(formula = treat ~ age + educ + married + nodegree + re74, data = lalonde, method = "ps", estimand = "ATT")

[4mBalance Measures[24m
               Type Diff.Adj
prop.score Distance   0.0199
age         Contin.   0.0459
educ        Contin.  -0.0360
married      Binary   0.0044
nodegree     Binary   0.0080
re74        Contin.  -0.0275

[4mEffective sample sizes[24m
           Control Treated
Unadjusted 429.000     185
Adjusted   255.989     185
> 
> #Balancing covariates with respect to race (multi-category)
> (W2 <- weightit(race ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "ebal", estimand = "ATE"))
A [3mweightit[23m object
 - method: "ebal" (entropy balancing)
 - number of obs.: 614
 - sampling weights: none
 - treatment: 3-category (black, hispan, white)
 - estimand: ATE
 - covariates: age, educ, married, nodegree, re74
> summary(W2)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

          Min                                   Max
black  1.3975 |-----------|                 13.5172
hispan 1.2102 |---------------------------| 28.4321
white  0.8170 |-|                            3.9492

- [3mUnits with 5 greatest weights by group[23m:
                                               
            485     244     226     182     181
  black  6.3711  6.4409    7.09  8.9826 13.5172
            564     392     371     345     269
 hispan 17.4558 21.5908 22.4375 23.0408 28.4321
            599     589     531     457      68
  white  3.5134  3.5373  3.5799   3.643  3.9492

- [3mWeight statistics[23m:

        Coef of Var   MAD Entropy
black         0.590 0.413 257.113
hispan        0.609 0.439 166.092
white         0.371 0.306 235.398
overall       0.966 0.560 849.911

- [3mEffective Sample Sizes[23m:

             black hispan   white
Unweighted 243.000  72.00 299.000
Weighted   180.477  52.74 262.932
> bal.tab(W2)
[4mCall[24m
 weightit(formula = race ~ age + educ + married + nodegree + re74, data = lalonde, method = "ebal", estimand = "ATE")

[4mBalance summary across all treatment pairs[24m
            Type Max.Diff.Adj
age      Contin.       0.0005
educ     Contin.       0.0012
married   Binary       0.0002
nodegree  Binary       0.0002
re74     Contin.       0.0001

[4mEffective sample sizes[24m
             black hispan   white
Unadjusted 243.000  72.00 299.000
Adjusted   180.477  52.74 262.932
> 
> #Balancing covariates with respect to re75 (continuous)
> (W3 <- weightit(re75 ~ age + educ + married +
+                   nodegree + re74, data = lalonde,
+                 method = "cbps", over = FALSE))
A [3mweightit[23m object
 - method: "cbps" (covariate balancing propensity score weighting)
 - number of obs.: 614
 - sampling weights: none
 - treatment: continuous
 - covariates: age, educ, married, nodegree, re74
> summary(W3)
                 [4mSummary of weights[24m

- [3mWeight ranges[23m:

       Min                                   Max
all 0.0153 |---------------------------| 13.1553

- [3mUnits with 5 greatest weights by group[23m:
                                           
        484     483     482     481     180
 all 9.2225 10.8379 11.1353 11.9904 13.1553

- [3mWeight statistics[23m:

    Coef of Var   MAD Entropy
all       1.152 0.449 178.615

- [3mEffective Sample Sizes[23m:

            Total
Unweighted 614.00
Weighted   264.09
> bal.tab(W3)
[4mCall[24m
 weightit(formula = re75 ~ age + educ + married + nodegree + re74, data = lalonde, method = "cbps", over = FALSE)

[4mBalance Measures[24m
            Type Corr.Adj
age      Contin.  -0.0002
educ     Contin.   0.0000
married   Binary  -0.0002
nodegree  Binary   0.0000
re74     Contin.  -0.0003

[4mEffective sample sizes[24m
            Total
Unadjusted 614.00
Adjusted   264.09
> 
> 
> 
> cleanEx()

detaching â€˜package:cobaltâ€™

> nameEx("weightitMSM")
> ### * weightitMSM
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: weightitMSM
> ### Title: Generate Balancing Weights
> ### Aliases: weightitMSM print.weightitMSM
> 
> ### ** Examples
> 
> library("twang")
Loading required package: gbm
Loaded gbm 2.1.5
Loading required package: survey
Loading required package: grid
Loading required package: Matrix
Loading required package: survival

Attaching package: â€˜surveyâ€™

The following object is masked from â€˜package:graphicsâ€™:

    dotchart

Loading required package: xtable
Loading required package: lattice
Loading required package: latticeExtra
> # library("cobalt")
> 
> data("iptwExWide", package = "twang")
> (W <- weightitMSM(list(tx1 ~ age + gender + use0,
+                       tx2 ~ tx1 + use1 + age + gender + use0,
+                       tx3 ~ tx2 + use2 + tx1 + use1 + age + gender + use0),
+                  data = iptwExWide,
+                  method = "ps"))
A [3mweightitMSM[23m object
 - method: "ps" (propensity score weighting)
 - number of obs.: 1000
 - sampling weights: none
 - number of time points: 3 (tx1, tx2, tx3)
 - treatment: 
    + time 1: 2-category
    + time 2: 2-category
    + time 3: 2-category
 - covariates: 
    + baseline: age, gender, use0
    + after time 1: tx1, use1, age, gender, use0
    + after time 2: tx2, use2, tx1, use1, age, gender, use0
> summary(W)
                 [4mSummary of weights[24m

[9m                      [29m[3m Time 1 [23m[9m                      [29m
- [3mWeight ranges[23m:

           Min                                   Max
treated 1.6667 |---|                         15.5292
control 2.6123 |---------------------------| 82.2349

- [3mUnits with 5 greatest weights by group[23m:
                                                
             642     350     324     299     228
 treated 13.4464 13.6233 13.7059  14.436 15.5292
             288     176     147      72      52
 control 44.8027 46.1355 58.4164 79.8919 82.2349

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.481 0.376 1317.833
control       0.768 0.494  819.850
overall       0.857 0.520 2314.014

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted  294.00 706.000
Weighted    185.18 573.598

[9m                      [29m[3m Time 2 [23m[9m                      [29m
- [3mWeight ranges[23m:

           Min                                   Max
treated 1.6667 |---------------------------| 82.2349
control 2.6123 |--------------------------|  79.8919

- [3mUnits with 5 greatest weights by group[23m:
                                                
             497     338     290     286      22
 treated  33.371 34.7405 42.9442 58.4164 82.2349
             265     139     103      47      39
 control 39.7862 42.2256 44.8027 46.1355 79.8919

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.960 0.653 1218.348
control       0.737 0.384 1095.956
overall       0.857 0.520 2314.014

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 492.000 508.000
Weighted   318.903 264.487

[9m                      [29m[3m Time 3 [23m[9m                      [29m
- [3mWeight ranges[23m:

           Min                                   Max
treated 1.6667 |-------------|               44.8027
control 2.6123 |---------------------------| 82.2349

- [3mUnits with 5 greatest weights by group[23m:
                                                
             548     450     382     124      67
 treated  26.003  26.471 28.0582 39.7862 44.8027
             403     264     226     224     110
 control 42.9442 46.1355 58.4164 79.8919 82.2349

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.773 0.565 1267.537
control       0.873 0.469 1023.060
overall       0.857 0.520 2314.014

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 415.000 585.000
Weighted   235.672 366.399

> # bal.tab(W)
> 
> ##Going from long to wide data
> data("iptwExLong", package = "twang")
> wide_data <- reshape(iptwExLong$covariates,    #long data
+                      timevar = "time",         #time variable
+                      v.names = c("use", "tx"), #time-varying
+                      idvar = "ID",             #time-stable
+                      direction = "wide",
+                      sep = "")
> 
> (W2 <- weightitMSM(list(tx1 ~ age + gender + use1,
+                       tx2 ~ tx1 + use2 + age + gender + use1,
+                       tx3 ~ tx2 + use3 + tx1 + use2 + age +
+                           gender + use1),
+                  data = wide_data,
+                  method = "ps"))
A [3mweightitMSM[23m object
 - method: "ps" (propensity score weighting)
 - number of obs.: 1000
 - sampling weights: none
 - number of time points: 3 (tx1, tx2, tx3)
 - treatment: 
    + time 1: 2-category
    + time 2: 2-category
    + time 3: 2-category
 - covariates: 
    + baseline: age, gender, use1
    + after time 1: tx1, use2, age, gender, use1
    + after time 2: tx2, use3, tx1, use2, age, gender, use1
> summary(W2)
                 [4mSummary of weights[24m

[9m                      [29m[3m Time 1 [23m[9m                      [29m
- [3mWeight ranges[23m:

           Min                                   Max
treated 1.6667 |---|                         15.5292
control 2.6123 |---------------------------| 82.2349

- [3mUnits with 5 greatest weights by group[23m:
                                                
             642     350     324     299     228
 treated 13.4464 13.6233 13.7059  14.436 15.5292
             288     176     147      72      52
 control 44.8027 46.1355 58.4164 79.8919 82.2349

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.481 0.376 1317.833
control       0.768 0.494  819.850
overall       0.857 0.520 2314.014

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted  294.00 706.000
Weighted    185.18 573.598

[9m                      [29m[3m Time 2 [23m[9m                      [29m
- [3mWeight ranges[23m:

           Min                                   Max
treated 1.6667 |---------------------------| 82.2349
control 2.6123 |--------------------------|  79.8919

- [3mUnits with 5 greatest weights by group[23m:
                                                
             497     338     290     286      22
 treated  33.371 34.7405 42.9442 58.4164 82.2349
             265     139     103      47      39
 control 39.7862 42.2256 44.8027 46.1355 79.8919

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.960 0.653 1218.348
control       0.737 0.384 1095.956
overall       0.857 0.520 2314.014

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 492.000 508.000
Weighted   318.903 264.487

[9m                      [29m[3m Time 3 [23m[9m                      [29m
- [3mWeight ranges[23m:

           Min                                   Max
treated 1.6667 |-------------|               44.8027
control 2.6123 |---------------------------| 82.2349

- [3mUnits with 5 greatest weights by group[23m:
                                                
             548     450     382     124      67
 treated  26.003  26.471 28.0582 39.7862 44.8027
             403     264     226     224     110
 control 42.9442 46.1355 58.4164 79.8919 82.2349

- [3mWeight statistics[23m:

        Coef of Var   MAD  Entropy
treated       0.773 0.565 1267.537
control       0.873 0.469 1023.060
overall       0.857 0.520 2314.014

- [3mEffective Sample Sizes[23m:

           Control Treated
Unweighted 415.000 585.000
Weighted   235.672 366.399

> 
> all.equal(W$weights, W2$weights)
[1] TRUE
> 
> 
> 
> ### * <FOOTER>
> ###
> cleanEx()

detaching â€˜package:twangâ€™, â€˜package:latticeExtraâ€™, â€˜package:latticeâ€™,
  â€˜package:xtableâ€™, â€˜package:surveyâ€™, â€˜package:survivalâ€™,
  â€˜package:Matrixâ€™, â€˜package:gridâ€™, â€˜package:gbmâ€™

> options(digits = 7L)
> base::cat("Time elapsed: ", proc.time() - base::get("ptime", pos = 'CheckExEnv'),"\n")
Time elapsed:  10.198 0.742 11.31 0.002 0.005 
> grDevices::dev.off()
null device 
          1 
> ###
> ### Local variables: ***
> ### mode: outline-minor ***
> ### outline-regexp: "\\(> \\)?### [*]+" ***
> ### End: ***
> quit('no')
